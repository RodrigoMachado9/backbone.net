##
# backbone.net — Inventário Ansible
#
# ⚠️  IMPORTANTE — Rede de management nas fases 01-04:
#
# Os IPs abaixo usam a rede MGMT (10.200.0.0/24), que só será criada na Fase 05.
# Para usar Ansible nas fases 01-04, escolha UMA das alternativas:
#
#   Opção A (recomendada): Adicione uma rede MGMT temporária no KVM:
#     1. Crie a rede: virsh net-define (rede isolada com bridge br-mgmt)
#     2. Conecte uma interface extra em cada VM (última ethN)
#     3. Configure IP estático 10.200.0.X nessa interface dentro do VyOS
#
#   Opção B: Use IPs de interfaces existentes acessíveis do host via bridges.
#     Troque os ansible_host abaixo pelos IPs de uplink (ex: 10.255.1.2 para edge-a)
#     e garanta que o host tem rota para essas subnets via bridge.
#
#   Opção C: Use virsh console + copie/cole os configs manualmente (sem Ansible).
#
##
all:
  children:

    # =========================================================
    # VyOS Routers
    # =========================================================
    vyos_routers:
      children:
        cores:
          hosts:
            core-dc1:
              ansible_host: 10.200.0.101
              hostname: core-dc1
              router_id: "10.0.0.1"
              loopback: "10.0.0.1/32"
              interfaces:
                eth0:
                  address: "10.255.0.1/30"
                  description: "CORE: dc1 <-> dc2"
                eth1:
                  address: "10.255.1.1/30"
                  description: "EDGE: dc1 <-> edge-a"
                eth2:
                  address: "10.255.3.1/30"
                  description: "EDGE: dc1 <-> edge-b"
                eth3:
                  address: "10.255.5.1/30"
                  description: "EDGE: dc1 <-> edge-c"
              ospf_networks:
                - "10.255.0.0/30"
                - "10.255.1.0/30"
                - "10.255.3.0/30"
                - "10.255.5.0/30"
              bgp:
                as: 65000
                neighbors:
                  - ip: "10.0.0.2"
                    remote_as: 65000
                    update_source: "lo"

            core-dc2:
              ansible_host: 10.200.0.102
              hostname: core-dc2
              router_id: "10.0.0.2"
              loopback: "10.0.0.2/32"
              interfaces:
                eth0:
                  address: "10.255.0.2/30"
                  description: "CORE: dc2 <-> dc1"
                eth1:
                  address: "10.255.2.1/30"
                  description: "EDGE: dc2 <-> edge-a"
                eth2:
                  address: "10.255.4.1/30"
                  description: "EDGE: dc2 <-> edge-b"
                eth3:
                  address: "10.255.6.1/30"
                  description: "EDGE: dc2 <-> edge-c"
              ospf_networks:
                - "10.255.0.0/30"
                - "10.255.2.0/30"
                - "10.255.4.0/30"
                - "10.255.6.0/30"
              bgp:
                as: 65000
                neighbors:
                  - ip: "10.0.0.1"
                    remote_as: 65000
                    update_source: "lo"

        edges:
          hosts:
            edge-a:
              ansible_host: 10.200.0.111
              hostname: edge-a
              router_id: "10.0.0.11"
              loopback: "10.0.0.11/32"
              interfaces:
                eth0:
                  address: "10.255.1.2/30"
                  description: "UPLINK: edge-a <-> core-dc1"
                eth1:
                  address: "10.255.2.2/30"
                  description: "UPLINK: edge-a <-> core-dc2"
                eth2:
                  address: "10.10.1.1/24"
                  description: "LAN: Cliente A"
              ospf_networks:
                - "10.255.1.0/30"
                - "10.255.2.0/30"
                - "10.10.1.0/24"

            edge-b:
              ansible_host: 10.200.0.112
              hostname: edge-b
              router_id: "10.0.0.12"
              loopback: "10.0.0.12/32"
              interfaces:
                eth0:
                  address: "10.255.3.2/30"
                  description: "UPLINK: edge-b <-> core-dc1"
                eth1:
                  address: "10.255.4.2/30"
                  description: "UPLINK: edge-b <-> core-dc2"
                eth2:
                  address: "10.10.2.1/24"
                  description: "LAN: Cliente B"
              ospf_networks:
                - "10.255.3.0/30"
                - "10.255.4.0/30"
                - "10.10.2.0/24"

            edge-c:
              ansible_host: 10.200.0.113
              hostname: edge-c
              router_id: "10.0.0.13"
              loopback: "10.0.0.13/32"
              interfaces:
                eth0:
                  address: "10.255.5.2/30"
                  description: "UPLINK: edge-c <-> core-dc1"
                eth1:
                  address: "10.255.6.2/30"
                  description: "UPLINK: edge-c <-> core-dc2"
                eth2:
                  address: "10.10.3.1/24"
                  description: "LAN: Cliente C"
              ospf_networks:
                - "10.255.5.0/30"
                - "10.255.6.0/30"
                - "10.10.3.0/24"

      vars:
        ansible_connection: ansible.netcommon.network_cli
        ansible_network_os: vyos.vyos.vyos
        ansible_user: vyos
        ansible_ssh_pass: vyos
        ansible_ssh_common_args: "-o StrictHostKeyChecking=no"

    # =========================================================
    # FortiGate (Fase 05+)
    # =========================================================
    fortigate:
      hosts:
        fg-edge:
          ansible_host: 10.200.0.1
          fg_interfaces:
            port1:
              ip: "10.255.100.2/30"
              alias: "WAN-ISP"
              allowaccess: "ping"
            port2:
              ip: "10.255.200.1/30"
              alias: "CORE-DC1"
              allowaccess: "ping"
            port3:
              ip: "10.200.0.1/24"
              alias: "MGMT"
              allowaccess: "ping https ssh"
      vars:
        ansible_connection: httpapi
        ansible_httpapi_use_ssl: true
        ansible_httpapi_validate_certs: false
        ansible_httpapi_port: 443
        ansible_network_os: fortinet.fortios.fortios
        ansible_user: admin
        ansible_password: ""
